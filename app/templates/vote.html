<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stimmabgabe - Blind Signature</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <style>
        body {
            background-color: #f5f5f5;
            padding-top: 2rem;
        }
        .card {
            margin-bottom: 1rem;
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
        }
        .card-header {
            font-weight: bold;
        }
        pre {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.25rem;
            font-size: 0.8rem;
            overflow-x: auto;
        }
        .step-inactive {
            opacity: 0.5;
        }
        .step-active {
            border: 2px solid #007bff;
        }
        .step-completed {
            border-left: 5px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Stimmabgabe mit Blinden Signaturen</h1>
        <p>Folge den Schritten, um deine Stimme sicher und anonym abzugeben.</p>
        
        <div class="row">
            <div class="col-md-8">
                <!-- Step 1: Enter student ID -->
                <div id="step1" class="card step-active">
                    <div class="card-header">
                        Schritt 1: Identifikation
                    </div>
                    <div class="card-body">
                        <p>Gib deine Matrikelnummer ein, um deine Wahlberechtigung zu überprüfen.</p>
                        <div class="mb-3">
                            <label for="student-id" class="form-label">Matrikelnummer:</label>
                            <input type="text" class="form-control" id="student-id" placeholder="z.B. student1">
                        </div>
                        <button class="btn btn-primary" id="btn-step1">Weiter</button>
                    </div>
                </div>
                
                <!-- Step 2: Create ballot -->
                <div id="step2" class="card step-inactive">
                    <div class="card-header">
                        Schritt 2: Stimmzettel erstellen
                    </div>
                    <div class="card-body">
                        <p>Wähle den Kandidaten, für den du abstimmen möchtest.</p>
                        <div class="mb-3">
                            <select class="form-select" id="ballot-choice">
                                <option value="" selected disabled>Bitte wählen...</option>
                                {% for candidate in candidates %}
                                <option value="{{ candidate }}">{{ candidate }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="raw-ballot" class="form-label">Dein Stimmzettel (als Zahl):</label>
                            <input type="text" class="form-control" id="raw-ballot" readonly>
                        </div>
                        <button class="btn btn-primary" id="btn-step2">Weiter</button>
                    </div>
                </div>
                
                <!-- Step 3: Blind the ballot -->
                <div id="step3" class="card step-inactive">
                    <div class="card-header">
                        Schritt 3: Stimmzettel blenden
                    </div>
                    <div class="card-body">
                        <p>Blende deinen Stimmzettel mit einem zufälligen Faktor, bevor du ihn zur Wahlbehörde sendest.</p>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-3">
                                    <label class="form-label">Public Key der Wahlbehörde:</label>
                                    <pre id="auth-public-key"></pre>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Blinding-Faktor (r):</label>
                                    <pre id="blinding-factor"></pre>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Geblendeter Stimmzettel:</label>
                                    <pre id="blinded-ballot"></pre>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary" id="btn-step3">Stimmzettel blenden</button>
                        <button class="btn btn-success" id="btn-step3-next" style="display: none;">Weiter</button>
                    </div>
                </div>
                
                <!-- Step 4: Send to authority -->
                <div id="step4" class="card step-inactive">
                    <div class="card-header">
                        Schritt 4: Signierung durch Wahlbehörde
                    </div>
                    <div class="card-body">
                        <p>Sende deinen geblendeten Stimmzettel zur Wahlbehörde zur Signierung.</p>
                        <div class="mb-3">
                            <label class="form-label">Geblendeter Stimmzettel:</label>
                            <pre id="blinded-ballot-to-auth"></pre>
                        </div>
                        <div class="mb-3" id="blind-signature-container" style="display: none;">
                            <label class="form-label">Blinde Signatur von der Wahlbehörde:</label>
                            <pre id="blind-signature"></pre>
                        </div>
                        <div class="alert alert-danger" id="auth-error" style="display: none;"></div>
                        <button class="btn btn-primary" id="btn-step4">Zur Signierung senden</button>
                        <button class="btn btn-success" id="btn-step4-next" style="display: none;">Weiter</button>
                    </div>
                </div>
                
                <!-- Step 5: Unblind signature -->
                <div id="step5" class="card step-inactive">
                    <div class="card-header">
                        Schritt 5: Signatur entblenden
                    </div>
                    <div class="card-body">
                        <p>Entferne den Blinding-Faktor von der Signatur, um eine gültige Signatur für deinen Stimmzettel zu erhalten.</p>
                        <div class="mb-3">
                            <label class="form-label">Blinde Signatur:</label>
                            <pre id="blind-sig-to-unblind"></pre>
                        </div>
                        <div class="mb-3" id="unblinded-signature-container" style="display: none;">
                            <label class="form-label">Entblendete Signatur:</label>
                            <pre id="unblinded-signature"></pre>
                        </div>
                        <button class="btn btn-primary" id="btn-step5">Signatur entblenden</button>
                        <button class="btn btn-success" id="btn-step5-next" style="display: none;">Weiter</button>
                    </div>
                </div>
                
                <!-- Step 6: Submit vote -->
                <div id="step6" class="card step-inactive">
                    <div class="card-header">
                        Schritt 6: Stimmabgabe
                    </div>
                    <div class="card-body">
                        <p>Gib deinen Stimmzettel anonym ab. Die Wahlbehörde kann die Gültigkeit deiner Stimme überprüfen, ohne zu wissen, wer du bist.</p>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Dein Stimmzettel:</label>
                                    <pre id="final-ballot"></pre>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Deine Signatur:</label>
                                    <pre id="final-signature"></pre>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-success" id="vote-success" style="display: none;">
                            Deine Stimme wurde erfolgreich abgegeben!
                        </div>
                        <div class="alert alert-danger" id="vote-error" style="display: none;"></div>
                        <button class="btn btn-primary" id="btn-step6">Stimme abgeben</button>
                        <a href="/" class="btn btn-link" id="btn-finish" style="display: none;">Zurück zur Startseite</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        Blind Signature Demo
                    </div>
                    <div class="card-body">
                        <h5>Wie funktioniert es?</h5>
                        <ol>
                            <li>Du erstellst einen Stimmzettel</li>
                            <li>Du "blindest" ihn mit einem zufälligen Faktor</li>
                            <li>Die Wahlbehörde signiert den geblendeten Stimmzettel</li>
                            <li>Du entfernst den Blinding-Faktor</li>
                            <li>Du erhältst eine gültige Signatur für deinen Stimmzettel</li>
                            <li>Du gibst deinen Stimmzettel anonym ab</li>
                        </ol>
                        <p class="text-muted">
                            <small>Diese Demo verwendet RSA für Blinde Signaturen. Alle kryptographischen Schritte werden im Browser ausgeführt, damit du den Prozess nachvollziehen kannst.</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/voting.js"></script>
</body>
</html> 